<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="img/lighthouse.ico" type="image/x-icon">
<title>Одесские баранки.&nbsp;¯\_(ツ)_/¯</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta naame="author" content="текст Вадим Сиротенко, художник Ирина Бабиченко">
<style>
html {
	height: 100%;
	width: 100%;
	min-height:100%;	
}
	body {
	height: 100%;
	width: 100%;
	min-height:100%;
	margin: 0;
	top: 0px;
	left: 0px;
	background-size: contain;
	background-position-x: center;
	background-position-y: top;
	background-repeat: no-repeat;
	background-attachment: fixed;
	background-image: url('img/1.jpg');
}
.ctrl {
/*	display: inline; */
	margin: 0 auto;
	position: absolute;
	text-align: center;
	bottom: 10px;
}
.arroundleft {
	padding-top: 6%;
	float: left;
	margin: 15px;
	border-style: none;
}
.arroundright {
	padding-top: 6%;
	float: right;
	margin: 15px;
	border-style: none;
}
.arrows_right {
	height: 5%;
	width: auto;
}
.arrows_left {
	height: 5%;
	width: auto;
}
</style>
<script>
var max_idx=43;
var idx=1;
//document.getElementsByTagName('img').style.height=document.documentElement.clientHeight*0.1+'px';
//document.getElementById('tuda').style.height=document.documentElement.clientHeight*0.1+'px';
//document.getElementById('suda').style.height=document.documentElement.clientHeight*0.1+'px';
function getCookie(name) {
	return document.cookie.replace(/(?:(?:^|.*;\s*)page\s*\=\s*([^;]*).*$)|^.*$/, "$1");
}

function setCookie(name, value) {
	document.cookie = name + '=' + value + '; max-age='+3600*24*31;
}

function changeStory(arg){
	idx=idx+(parseInt(arg));
	if(idx<1)idx=max_idx;
	if(idx>max_idx)idx=1;
	document.body.style.backgroundImage = 'url(' + 'img/'+idx+'.jpg' + ')';
	document.getElementById('story').src='audio/'+idx+'.wav';
	if(document.getElementById('autoplay').src.indexOf('start.png')>0) {
		document.getElementById('story').pause();
	}else{
		document.getElementById('story').play();
	};
	setCookie('page', idx);
};
var handler = {
    handleEvent: function(e){changeStory(1)}
};
function getAutoPlay(){
	if(document.getElementById('autoplay').src.indexOf('start.png')>0) {
		document.getElementById('autoplay').src='img/stop.png';
		document.getElementById('autoplay').title='Выключить автоматическое проигрывание';
		document.getElementById('story').addEventListener("ended", handler, true);
		document.getElementById('story').play();
	}else{
		document.getElementById('autoplay').src='img/start.png';
		document.getElementById('autoplay').title='Включить автоматическое проигрывание';
		document.getElementById('story').removeEventListener("ended", handler, true);
	};
}
</script>
</head>
<body id="pictIB">
<div class="ctrl">
	<audio id="story" src="audio/1.wav" controls="true" controlsList="nodownload"></audio>
	<img id="autoplay" style="float: right; margin-top: 2%;" src="img/start.png" onclick="getAutoPlay()" title="Включить автоматическое проигрывание">
</div>
<div class="arroundright"><img id="tuda" class="arrows_right" src="img/nose_right.png" title="Тудой!" onclick="changeStory('+1');"></div>
<div class="arroundleft"><img id="suda" class="arrows_left" src="img/nose_left.png" title="Сюдой!" onclick="changeStory('-1');"></div>
<script>
var page = parseInt(getCookie('page'));
alert('page='+page);
if(isNaN(page) || page === undefined){
	idx=1;
}else{
	idx=page;
};
alert('2) page='+page);
document.body.style.backgroundImage = 'url(' + 'img/'+idx+'.jpg' + ')';
document.getElementById('story').src='audio/'+idx+'.wav';
document.getElementById('story').pause();
</script>
</body>
</html>
